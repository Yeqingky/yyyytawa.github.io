const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StreamSaver-B3tL5eyM.js","assets/commonjsHelpers-Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{c as a,o as c,h as u,b as l,t as d,i as g,v as S,F as m,e as y,f as v,j as p,k as w,n as b,_ as f,d as _,u as P}from"./app-B4DDR1L1.js";import{_ as E}from"./plugin-vue_export-helper-DlAUqK2U.js";const x={name:"Sticker",props:{title:{type:String,default:""},desc:{type:String,default:""},link:{type:String,required:!0},background:{type:String,default:""},page:{type:Number,default:20},prefix:{type:String,default:""},showname:{type:Boolean,default:!0}},data(){return{stickers:[],loading:!0,error:null,configError:null,currentPage:1,localPageSize:this.page,selectedStickers:[],selectAll:!1,downloading:!1,downloadMethod:"stream",generatedFileNames:[]}},computed:{backgroundStyle(){return this.background?this.background.startsWith("http")||this.background.startsWith("/")?`url(${this.background})`:this.background:""},totalPages(){return Math.ceil(this.stickers.length/this.localPageSize)},paginatedStickers(){const t=(this.currentPage-1)*this.localPageSize,e=t+this.localPageSize;return this.stickers.slice(t,e)}},watch:{page(t){this.localPageSize=t},currentPage(){this.selectAll=!1}},async mounted(){await this.initDownloadLibs(),this.fetchStickers()},methods:{async initDownloadLibs(){if(!(typeof window>"u"))try{const t=await f(()=>import("./index-B2wr9ne3.js"),[]);this.$downloadZip=t.downloadZip;const e=await f(()=>import("./StreamSaver-B3tL5eyM.js").then(o=>o.S),__vite__mapDeps([0,1]));this.$streamSaver=e.default,this.$streamSaver.mitm="https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"}catch(t){console.error("加载下载库失败:",t),this.downloadMethod="blob"}},async fetchStickers(){try{this.loading=!0;const t=await fetch(this.link,{credentials:"same-origin"});if(!t.ok){this.configError=`获取配置失败: HTTP ${t.status}`;return}const e=await t.json();Array.isArray(e)&&e.every(o=>typeof o=="object"&&o!==null&&o.url)?(this.stickers=e,this.configError=null):(this.configError='JSON 配置格式不正确，期望一个包含 {url: "..."} 对象的数组。',this.stickers=[])}catch(t){this.configError=`加载或解析配置失败: ${t.message}`}finally{this.loading=!1}},getStickerUrl(t){if(!t)return"";try{const e=encodeURI(decodeURIComponent(t));return this.prefix&&!t.startsWith("/")?`${this.prefix.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`:e}catch{return t}},handleImageError(t){this.$set(t,"error",!0)},validatePageSize(){this.localPageSize=Math.min(200,Math.max(1,this.localPageSize)),this.currentPage=1},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},toggleSelectAll(){const t=this.paginatedStickers;this.selectedStickers=this.selectAll?[...new Set([...this.selectedStickers,...t])]:this.selectedStickers.filter(e=>!t.includes(e))},updateSelectAll(){this.selectAll=this.paginatedStickers.every(t=>this.selectedStickers.includes(t))},getFileExtension(t){const e=t.split(/[#?]/)[0].split(".");return e.length>1?e.pop().toLowerCase():"png"},getFileName(t){const e=this.getFileExtension(t.url),o=t.name||`sticker-${Date.now()}`;let n=`${o}.${e}`,s=1;for(;this.generatedFileNames.includes(n);)n=`${o}_${s++}.${e}`;return this.generatedFileNames.push(n),n},async downloadAll(){if(!(this.downloading||!this.$downloadZip)){this.downloading=!0,this.error=null,this.generatedFileNames=[];try{const t=this.selectedStickers.length>0?this.selectedStickers:this.stickers;if(t.length===0){this.error="没有可下载的表情包。";return}const e=await Promise.all(t.map(async n=>{if(!n.url)return console.warn("跳过无效URL的表情包:",n),null;try{const s=await fetch(this.getStickerUrl(n.url));if(!s.ok)throw new Error(`HTTP ${s.status} for ${n.url}`);return{name:this.getFileName(n),input:await s.blob(),lastModified:new Date}}catch(s){return console.error(`下载表情包失败: ${n.url}`,s),this.error=`部分表情包下载失败: ${s.message}`,null}})).then(n=>n.filter(s=>s!==null));if(e.length===0){this.error="没有成功下载的表情包用于打包。";return}const o=`sticker-pack-${Date.now()}.zip`;if(this.downloadMethod==="stream"&&this.$streamSaver){const n=this.$streamSaver.createWriteStream(o);await this.$downloadZip(e).body.pipeTo(n)}else{const n=await this.$downloadZip(e).blob(),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(s),100)}}catch(t){this.error=`打包下载失败: ${t.message}`}finally{this.downloading=!1}}}}},z={key:0,class:"sticker-header"},A={key:0},T={class:"controls-section"},N={class:"page-size-selector"},M={class:"pagination-controls"},C=["disabled"],U=["disabled"],D={key:1,class:"loading"},F={key:2,class:"empty-message"},L={key:3,class:"sticker-grid"},j={class:"sticker-checkbox"},B=["value"],R={class:"sticker-img-container"},V=["src","alt","onError"],I={key:0,class:"image-error-tip"},Z={key:0,class:"sticker-name"},O={key:4,class:"download-section"},W={class:"select-controls"},H={class:"selected-count"},J=["disabled"],q={key:0},G={key:1},K={key:5,class:"error-message"};function Q(t,e,o,n,s,r){return c(),a("div",{class:"sticker-container",style:b({background:r.backgroundStyle})},[o.title?(c(),a("div",z,[l("h2",null,d(o.title),1),o.desc?(c(),a("p",A,d(o.desc),1)):u("v-if",!0)])):u("v-if",!0),l("div",T,[l("div",N,[e[10]||(e[10]=l("span",null,"每页数量：",-1)),g(l("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=i=>s.localPageSize=i),min:"1",max:"200",onChange:e[1]||(e[1]=(...i)=>r.validatePageSize&&r.validatePageSize(...i))},null,544),[[S,s.localPageSize,void 0,{number:!0}]])]),l("div",M,[l("button",{onClick:e[2]||(e[2]=(...i)=>r.prevPage&&r.prevPage(...i)),disabled:s.currentPage===1},"上一页",8,C),l("span",null,"第 "+d(s.currentPage)+" 页 / 共 "+d(r.totalPages)+" 页",1),l("button",{onClick:e[3]||(e[3]=(...i)=>r.nextPage&&r.nextPage(...i)),disabled:s.currentPage===r.totalPages},"下一页",8,U)])]),s.loading?(c(),a("div",D,"加载表情包配置中...")):s.stickers.length===0?(c(),a("div",F,[s.configError?(c(),a(m,{key:0},[y(d(s.configError),1)],64)):(c(),a(m,{key:1},[y(" 没有找到表情包，请检查配置文件 ")],64))])):(c(),a("div",L,[(c(!0),a(m,null,v(r.paginatedStickers,(i,k)=>(c(),a("div",{key:k,class:"sticker-item"},[l("div",j,[g(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=h=>s.selectedStickers=h),value:i,onChange:e[5]||(e[5]=(...h)=>r.updateSelectAll&&r.updateSelectAll(...h))},null,40,B),[[p,s.selectedStickers]])]),l("div",R,[l("img",{src:r.getStickerUrl(i.url),alt:i.name||"表情包",loading:"lazy",onError:h=>r.handleImageError(i)},null,40,V),i.error?(c(),a("div",I,"加载失败")):u("v-if",!0)]),o.showname&&i.name?(c(),a("div",Z,d(i.name),1)):u("v-if",!0)]))),128))])),s.stickers.length>0?(c(),a("div",O,[l("div",W,[l("label",null,[g(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=i=>s.selectAll=i),onChange:e[7]||(e[7]=(...i)=>r.toggleSelectAll&&r.toggleSelectAll(...i))},null,544),[[p,s.selectAll]]),e[11]||(e[11]=y(" 全选当前页 "))]),l("span",H,"已选 "+d(s.selectedStickers.length)+" 个",1),g(l("select",{"onUpdate:modelValue":e[8]||(e[8]=i=>s.downloadMethod=i),class:"download-method"},e[12]||(e[12]=[l("option",{value:"stream"},"流式下载(推荐)",-1),l("option",{value:"blob"},"普通下载",-1)]),512),[[w,s.downloadMethod]])]),l("button",{onClick:e[9]||(e[9]=(...i)=>r.downloadAll&&r.downloadAll(...i)),disabled:s.downloading||s.selectedStickers.length===0,class:"download-btn"},[s.downloading?(c(),a("span",q,"打包中...")):(c(),a("span",G,"下载选中表情包 ("+d(s.selectedStickers.length||"全部")+")",1))],8,J)])):u("v-if",!0),s.error?(c(),a("div",K,d(s.error),1)):u("v-if",!0)],4)}const X=E(x,[["render",Q],["__scopeId","data-v-0f566dda"]]),ee={__name:"小新喵.html",setup(t){return(e,o)=>(c(),a("div",null,[_(P(X),{link:"https://cf-img.yyyyt.top/docs/album/stickers/小新喵.json",prefix:"https://cf-img.yyyyt.top/meme/小新喵"})]))}},te=JSON.parse('{"path":"/album/stickers/%E5%B0%8F%E6%96%B0%E5%96%B5.html","title":"小新喵","lang":"zh-CN","frontmatter":{"title":"小新喵","head":[["meta",{"property":"og:url","content":"https://docs.yyyyt.top/album/stickers/%E5%B0%8F%E6%96%B0%E5%96%B5.html"}],["meta",{"property":"og:site_name","content":"yyyyt的文档站"}],["meta",{"property":"og:title","content":"小新喵"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-05T05:09:48.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-05T05:09:48.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"小新喵\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-07-05T05:09:48.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yyyyt\\",\\"url\\":\\"https://docs.yyyyt.top/site/about_me\\"}]}"]]},"git":{"createdTime":1751178870000,"updatedTime":1751692188000,"contributors":[{"name":"yyyytawa","username":"yyyytawa","email":"116234899+yyyytawa@users.noreply.github.com","commits":3,"avatar":"https://avatars.githubusercontent.com/yyyytawa?v=4","url":"https://github.com/yyyytawa"}]},"readingTime":{"minutes":0.09,"words":28},"filePathRelative":"album/stickers/小新喵.md","localizedDate":"2025年6月29日","excerpt":""}');export{ee as comp,te as data};
